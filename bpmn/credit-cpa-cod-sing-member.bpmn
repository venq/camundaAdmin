<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_19jgi74" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.24.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.5.0">
  <bpmn:message id="Message_2nqobu6" name="SENDING_SIGNED_OFFER">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=orderId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:collaboration id="Collaboration_0ensr9a">
    <bpmn:participant id="Participant_106pa68" name="Подписание КОД участником" processRef="credit-cpa-cod-sing-member" />
  </bpmn:collaboration>
  <bpmn:process id="credit-cpa-cod-sing-member" name="Подписание каждым участником" isExecutable="true">
    <bpmn:serviceTask id="Activity_11erl2g" name="Получение email ЕИО">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="=mainEmployeeId" target="businessId" />
          <zeebe:output source="=body.contacts[item.email != null].email[1]" target="orderMemberEmail" />
        </zeebe:ioMapping>
        <zeebe:taskDefinition type="GET /api/company/person/business/{businessId}" retries="0" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_08v6a3c</bpmn:incoming>
      <bpmn:outgoing>Flow_1cuoqzs</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_155y59z" name="Получение идентификатора ЕИО">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="GET /api/company/relation/right-id-search/" retries="0" />
        <zeebe:ioMapping>
          <zeebe:input source="=&#34;employee&#34;" target="relationTypeRefId" />
          <zeebe:input source="=personCompanyDto.businessId" target="rightId" />
          <zeebe:input source="=true" target="isMain" />
          <zeebe:output source="=body[1].leftId" target="mainEmployeeId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0v6v24p</bpmn:incoming>
      <bpmn:outgoing>Flow_08v6a3c</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_16bl69n" name="Получение email участника сделки ФЛ">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="=personCompanyDto.businessId" target="businessId" />
          <zeebe:output source="=body.contacts[item.email != null].email[1]" target="orderMemberEmail" />
        </zeebe:ioMapping>
        <zeebe:taskDefinition type="GET /api/company/person/business/{businessId}" retries="0" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0hguz4w</bpmn:incoming>
      <bpmn:outgoing>Flow_1uhqi9p</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_01pb19r" default="Flow_1ijlga1">
      <bpmn:incoming>Flow_1lrfl7o</bpmn:incoming>
      <bpmn:outgoing>Flow_1ijlga1</bpmn:outgoing>
      <bpmn:outgoing>Flow_0mpoasc</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_0wvvxgo">
      <bpmn:incoming>Flow_1cuoqzs</bpmn:incoming>
      <bpmn:incoming>Flow_1uhqi9p</bpmn:incoming>
      <bpmn:outgoing>Flow_0rurckc</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_03itg2h" default="Flow_134i36x">
      <bpmn:incoming>Flow_0rurckc</bpmn:incoming>
      <bpmn:outgoing>Flow_134i36x</bpmn:outgoing>
      <bpmn:outgoing>Flow_098qxqi</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="Activity_093fgi5" name="Проверка типов подписей">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="credit-cpa-cod-sing-member.ServiceTaskCheckTypeSignature" retries="0" />
        <zeebe:ioMapping>
          <zeebe:input source="=if member != null then member.id else &#34;&#34;" target="entityId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1jz4wwp</bpmn:incoming>
      <bpmn:outgoing>Flow_1lrfl7o</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:startEvent id="Event_0e3voqf">
      <bpmn:outgoing>Flow_1jz4wwp</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="credit-cpa-cod-sing-member.UserTaskSignDocumentsBorrower" name="Подписание УКЭП">
      <bpmn:extensionElements>
        <zeebe:taskHeaders>
          <zeebe:header key="name" value="Подписание УКЭП" />
        </zeebe:taskHeaders>
        <zeebe:assignmentDefinition candidateGroups="ADMIN" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_098qxqi</bpmn:incoming>
      <bpmn:outgoing>Flow_0yftdo6</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="credit-cpa-cod-sing-member.UserTaskSignDocuments" name="Подписание УКЭП">
      <bpmn:extensionElements>
        <zeebe:taskHeaders>
          <zeebe:header key="name" value="Подписание УКЭП" />
        </zeebe:taskHeaders>
        <zeebe:assignmentDefinition candidateGroups="ADMIN" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_134i36x</bpmn:incoming>
      <bpmn:outgoing>Flow_1mqfun4</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_12dqli6">
      <bpmn:incoming>Flow_0bsgcsr</bpmn:incoming>
      <bpmn:incoming>Flow_0yftdo6</bpmn:incoming>
      <bpmn:outgoing>Flow_1t65tcu</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="Gateway_07sr3qh">
      <bpmn:incoming>Flow_1mqfun4</bpmn:incoming>
      <bpmn:incoming>Flow_1t65tcu</bpmn:incoming>
      <bpmn:incoming>Flow_1ijlga1</bpmn:incoming>
      <bpmn:outgoing>Flow_14josck</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_0juqy2f">
      <bpmn:incoming>Flow_14josck</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_1c0f91x" name="ЮЛ или ИП ?" default="Flow_0hguz4w">
      <bpmn:incoming>Flow_0mpoasc</bpmn:incoming>
      <bpmn:outgoing>Flow_0v6v24p</bpmn:outgoing>
      <bpmn:outgoing>Flow_0hguz4w</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:boundaryEvent id="Event_1w0zt4e" name="SENDING_SIGNED_OFFER" attachedToRef="credit-cpa-cod-sing-member.UserTaskSignDocumentsBorrower">
      <bpmn:outgoing>Flow_0bsgcsr</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0r3ss85" messageRef="Message_2nqobu6" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_08v6a3c" sourceRef="Activity_155y59z" targetRef="Activity_11erl2g" />
    <bpmn:sequenceFlow id="Flow_1cuoqzs" sourceRef="Activity_11erl2g" targetRef="Gateway_0wvvxgo" />
    <bpmn:sequenceFlow id="Flow_0v6v24p" name="ЮЛ" sourceRef="Gateway_1c0f91x" targetRef="Activity_155y59z">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=member != null and member.type = "company"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0hguz4w" name="ИП" sourceRef="Gateway_1c0f91x" targetRef="Activity_16bl69n" />
    <bpmn:sequenceFlow id="Flow_1uhqi9p" sourceRef="Activity_16bl69n" targetRef="Gateway_0wvvxgo" />
    <bpmn:sequenceFlow id="Flow_1lrfl7o" sourceRef="Activity_093fgi5" targetRef="Gateway_01pb19r" />
    <bpmn:sequenceFlow id="Flow_1ijlga1" name="Нет документов для подписания" sourceRef="Gateway_01pb19r" targetRef="Gateway_07sr3qh" />
    <bpmn:sequenceFlow id="Flow_0mpoasc" sourceRef="Gateway_01pb19r" targetRef="Gateway_1c0f91x">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=hasDocsToSign != null and hasDocsToSign = true</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0rurckc" sourceRef="Gateway_0wvvxgo" targetRef="Gateway_03itg2h" />
    <bpmn:sequenceFlow id="Flow_134i36x" sourceRef="Gateway_03itg2h" targetRef="credit-cpa-cod-sing-member.UserTaskSignDocuments" />
    <bpmn:sequenceFlow id="Flow_098qxqi" name="Участник сделки - заемщик" sourceRef="Gateway_03itg2h" targetRef="credit-cpa-cod-sing-member.UserTaskSignDocumentsBorrower">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=list contains(personCompanyDto.roles, "borrower")</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1jz4wwp" sourceRef="Event_0e3voqf" targetRef="Activity_093fgi5" />
    <bpmn:sequenceFlow id="Flow_0yftdo6" sourceRef="credit-cpa-cod-sing-member.UserTaskSignDocumentsBorrower" targetRef="Gateway_12dqli6" />
    <bpmn:sequenceFlow id="Flow_1mqfun4" sourceRef="credit-cpa-cod-sing-member.UserTaskSignDocuments" targetRef="Gateway_07sr3qh" />
    <bpmn:sequenceFlow id="Flow_0bsgcsr" sourceRef="Event_1w0zt4e" targetRef="Gateway_12dqli6" />
    <bpmn:sequenceFlow id="Flow_1t65tcu" sourceRef="Gateway_12dqli6" targetRef="Gateway_07sr3qh" />
    <bpmn:sequenceFlow id="Flow_14josck" sourceRef="Gateway_07sr3qh" targetRef="Event_0juqy2f" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0ensr9a">
      <bpmndi:BPMNShape id="Participant_106pa68_di" bpmnElement="Participant_106pa68" isHorizontal="true">
        <dc:Bounds x="130" y="80" width="1660" height="510" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1v9dj2t" bpmnElement="Activity_11erl2g">
        <dc:Bounds x="910" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1frofdu" bpmnElement="Activity_155y59z">
        <dc:Bounds x="750" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0r2hpxx" bpmnElement="Activity_16bl69n">
        <dc:Bounds x="910" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1or9mia" bpmnElement="Gateway_01pb19r" isMarkerVisible="true">
        <dc:Bounds x="475" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="528" y="270" width="84" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_03nbkwi" bpmnElement="Gateway_0wvvxgo" isMarkerVisible="true">
        <dc:Bounds x="1075" y="275" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1sfa9tg" bpmnElement="Gateway_03itg2h" isMarkerVisible="true">
        <dc:Bounds x="1185" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="8233" y="2567" width="56" height="66" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_02duee4" bpmnElement="Activity_093fgi5">
        <dc:Bounds x="310" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0rxloce" bpmnElement="Event_0e3voqf" bioc:stroke="#43a047" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#43a047">
        <dc:Bounds x="212" y="282" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0mghywm" bpmnElement="credit-cpa-cod-sing-member.UserTaskSignDocumentsBorrower">
        <dc:Bounds x="1330" y="400" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0h4rj23" bpmnElement="credit-cpa-cod-sing-member.UserTaskSignDocuments">
        <dc:Bounds x="1330" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1n1iolw" bpmnElement="Gateway_12dqli6" isMarkerVisible="true">
        <dc:Bounds x="1545" y="415" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_14xw5re" bpmnElement="Gateway_07sr3qh" isMarkerVisible="true">
        <dc:Bounds x="1545" y="275" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0j9m7mg" bpmnElement="Event_0juqy2f" bioc:stroke="#43a047" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#43a047">
        <dc:Bounds x="1672" y="282" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1ekc2r0" bpmnElement="Gateway_1c0f91x" isMarkerVisible="true">
        <dc:Bounds x="615" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="607" y="253" width="68" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_13aauv7" bpmnElement="Event_1w0zt4e" bioc:stroke="#fb8c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#fb8c00">
        <dc:Bounds x="1412" y="462" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1458" y="496" width="84" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_0pku0if" bpmnElement="Flow_08v6a3c" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="850" y="300" />
        <di:waypoint x="910" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0wjadre" bpmnElement="Flow_1cuoqzs" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1010" y="300" />
        <di:waypoint x="1075" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0o3u3e4" bpmnElement="Flow_0v6v24p" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="665" y="300" />
        <di:waypoint x="750" y="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="681" y="282" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_1wsec4h" bpmnElement="Flow_0hguz4w" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="640" y="325" />
        <di:waypoint x="640" y="450" />
        <di:waypoint x="910" y="450" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="652" y="433" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0hwimol" bpmnElement="Flow_1uhqi9p" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1010" y="450" />
        <di:waypoint x="1100" y="450" />
        <di:waypoint x="1100" y="325" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0mgvlxi" bpmnElement="Flow_1lrfl7o" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="410" y="300" />
        <di:waypoint x="475" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0n4ahrd" bpmnElement="Flow_1ijlga1" bioc:stroke="#1e88e5" color:border-color="#1e88e5">
        <di:waypoint x="500" y="275" />
        <di:waypoint x="500" y="170" />
        <di:waypoint x="1570" y="170" />
        <di:waypoint x="1570" y="275" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="509" y="176" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0lyi1ck" bpmnElement="Flow_0mpoasc" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="525" y="300" />
        <di:waypoint x="615" y="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="7552" y="2652" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0fv4k6u" bpmnElement="Flow_0rurckc" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1125" y="300" />
        <di:waypoint x="1185" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_14yi5jx" bpmnElement="Flow_134i36x" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1235" y="300" />
        <di:waypoint x="1330" y="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="8270" y="2743" width="20" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0he7iv9" bpmnElement="Flow_098qxqi" bioc:stroke="#8e24aa" color:border-color="#8e24aa">
        <di:waypoint x="1210" y="325" />
        <di:waypoint x="1210" y="440" />
        <di:waypoint x="1330" y="440" />
        <bpmndi:BPMNLabel color:color="#5b176d">
          <dc:Bounds x="1222" y="406" width="84" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_1vsnnv8" bpmnElement="Flow_1jz4wwp" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="248" y="300" />
        <di:waypoint x="310" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0g6peva" bpmnElement="Flow_0yftdo6" bioc:stroke="#8e24aa" color:border-color="#8e24aa">
        <di:waypoint x="1430" y="440" />
        <di:waypoint x="1545" y="440" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_1vivxce" bpmnElement="Flow_1mqfun4" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1430" y="300" />
        <di:waypoint x="1545" y="300" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_196jv3i" bpmnElement="Flow_0bsgcsr" bioc:stroke="#fb8c00" color:border-color="#fb8c00">
        <di:waypoint x="1430" y="498" />
        <di:waypoint x="1430" y="530" />
        <di:waypoint x="1570" y="530" />
        <di:waypoint x="1570" y="465" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_09e6leb" bpmnElement="Flow_1t65tcu" bioc:stroke="#8e24aa" color:border-color="#8e24aa">
        <di:waypoint x="1570" y="415" />
        <di:waypoint x="1570" y="325" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0f790dy" bpmnElement="Flow_14josck" bioc:stroke="#43a047" color:border-color="#43a047">
        <di:waypoint x="1595" y="300" />
        <di:waypoint x="1672" y="300" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
